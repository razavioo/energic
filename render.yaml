services:
  # 1. MQTT Broker
  # NOTE: This service MUST be named 'energic-broker' for other services to find it by default.
  # If you name it something else, update the BROKER_URL env vars below.
  - type: web
    name: energic-broker
    env: node
    buildCommand: cd broker && npm install
    startCommand: cd broker && npm start
    plan: free

  # 2. Sensor Simulator
  - type: worker
    name: energic-sensor
    env: node
    buildCommand: cd sensor && npm install
    startCommand: cd sensor && npm start
    envVars:
      - key: BROKER_URL
        value: wss://energic-broker.onrender.com
      - key: DEVICE_ID
        value: silo-01

  # 3. Admin Panel
  - type: web
    name: energic-admin
    env: node
    buildCommand: cd admin && npm install && npm run build
    startCommand: cd admin && npm start
    envVars:
      - key: NEXT_PUBLIC_BROKER_URL
        value: wss://energic-broker.onrender.com

  # 4. Visualizer
  - type: web
    name: energic-visualizer
    env: static
    buildCommand: cd visualizer && npm install && npm run build
    staticPublishPath: visualizer/dist
    envVars:
      - key: VITE_BROKER_URL
        value: wss://energic-broker.onrender.com
